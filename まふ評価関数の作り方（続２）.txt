評価関数を作成してみて気になっていることを書いておきます


■千田六段の指摘について

＞mafuが強いと評判ですが、elmoのほうが正確な局面群があることを確認しています。(2日くらい前に公開されたやつ)
＞ どのように評価関数を作成されたのか細かいところは存じませんが、作成過程にマイナスになるようなところがあるかどうか検討する価値はあるのかもしれません。

「まふ評価関数の作り方（まとめ？）」でも書いたように、「まふ定跡」ver1からver11までを学習させました。
「まふ定跡」は元々「技巧」に搭載して「浮かむ瀬」に追いつくような作りになっていて、elmoは浮かむ瀬を最適化していることから、進化ルートはかなり近い側面を持っていると思います。

ちょっと失敗したかなって思っているのが、この段階で「無限絞り」を発見してelmoと同等になってしまったため、そこから独自ルートへ転換しました。
何が失敗かと言いますと「elmo定跡」は「まふ定跡」をスナイプしている定跡だったので、elmoと同等になったときに「elmo定跡」で学習していれば
「まふ定跡」の穴が埋まってもう一段階上のレートに到達していたはずです。

ですから現在の「まふ評価関数」は教師局面の少なさもあって、この穴が残ったままであると考えています。
手元でもelmoと評価値が大きく食い違った状態で反省させられると、レート差があるのにほぼ逆転できていないことを確認しています。

つまり、千田六段の指摘はとても的確です。


■手持ちの最高レート評価関数だと角換わり定跡が死んだ

プロ棋士の方とかは結構気になるかと思いますので書いておきますと、
Ｒ４１００付近になってくるといままでの定跡がいろいろ使えなくなりました。elmoとは互角だった局面で−３００とか出して来たり、
浮かむ瀬時代では無理攻めだったのが成立したり。完全に作り直し状態です。

ただ不思議なのはコレをどこで学習したのかが分かりません。
今考えている仮設では、私が作っていた角換わり定跡が適度に弱くて、指導対局のような状態で学習したのではないか？という説です。

つまり、教師局面生成は自己対局型よりも２エンジン（別評価関数）との対局で生成するほうがプレイアウトの質がとても高い教師（指導）局面になるのでは？


■Twitterの疑問点と思われるヶ所を補足

＞理屈はまあ納得できるのですが「500万局面の再評価」から「depth6で3億」までの繋がりがよくわかりません。アマチュアなどの棋譜を沢山用意して定跡手数を変えながら投了値100の設定でやねうら王で雑巾作ったということでしょか？
＞自分もまふ氏の文章を理解することができません…。tanuki-理論チームもまふ氏の文章は難しいと言っています…。

ここの部分かな？「まふ評価関数の作り方（続）.txt」より
＞なので、実際に将棋で指された（人間＋ソフト）の指し手を好手、悪手関係なく５００万手を再評価してみました。
定跡登録で採用率をすべて均等にし、２０手、３０手、４０手、５０手・・・と作って、投了値を１００として定跡を抜けた瞬間の局面、
細かい評価値はともかくどっちが良いかくらい分かるだろうと再評価しました。
elmo式だとこれで勝敗のボーナスが正しく付くんじゃないかなー？とやってみました。

これだと教師局面の生成も超高速で出来ました。
それをdepth６×３億局面の学習１周で実施。


私はこのコマンドで教師局面の生成を行っています。
@echo off
:loop
YaneuraOuV471learn.exe threads 2 , ResignValue 100 , hash 256 , bookmoves 20 , bookfile book.bin , BookDepthLimit 0 , ConsiderBookMoveCount true , gensfen random_move_maxply 0 random_move_count 0 depth 6 eval_limit 32000 loop 1000000 , quit
goto loop


で、bookmoves の値を２０，３０，４０，５０・・・と変化させています。
テクニックとしては、序盤重視なら序盤の局面を多めに生成。中盤重視なら中盤の局面を多めに生成。これらを合計３億局面です。
（この辺の按排は生成スピードを見ながら、時間がかかっている定跡抜け部分を多く生成したりしています）

私のi3-3240のsse4.2でさえ、この条件だと８０００万／日で局面生成出来るので、開発者なら１日あれば３億局面生成から学習まで出来ると思います。

※ネタバレしちゃいましたけど「 	まふ評価関数の作り方（まとめ？）.txt」に書いていた、
＞公開はしませんが、定跡使用による高速教師局面生成を発見。
１億局面／３日が２．４億局面／３日になる

が上記の生成法です。


現在最高レートの手持ち評価関数は７月４日に作成したＲ４２００相当と、同日にそれと全然評価値が違うのにＲ４２３０程度の評価関数が作成出来ています。
（ひょっとしたらＫＰＰＴの器の大きさに限界が来ていて、両方の性質を持たせる評価関数は難しいのかもしれません）
やね氏公式ブログ「従来手法に基づくプロの棋譜を用いない評価関数の学習」の書込みの通り、
６月２１日にコマンドさえ打てなかった私が手探りの中、２週間でこのくらいの評価関数を作成出来ていますので、
今後「mafu10」から様々な評価関数が生まれることを期待しております。
（すでに私の周りで、評価関数作成初めての人が３日で「mafu」を超えた物を作成出来たことを確認しております）


■issueに来ていた質問について「中盤や終盤力はいかがでしょうか 」

＞現在公開されている、まふの評価関数はelmo超えているようですが、中盤や終盤力に関してはelmo超えているのでしょうか？
＞序盤に関してはまふ定跡によるアドバンテージあるので定跡オフにしなければレート上昇でしょうが。

配布しています「mafu」については、序盤に定跡使用で変な変化を踏まない限り、elmo相手なら中盤の期待勝率は７０％を超えます。

終盤力は正直に言えば分かりません。
まず終盤は探索部のウエイトが大きすぎて、最新のやねうら王を使用する限り、Ｒ４１００程度を超える領域では評価値７００も付けば
まともなノード数を読む限りほぼ逆転されないので、中盤次第ではないでしょうか？


--------------------------------------------------書きかけ--------------------------------------------------