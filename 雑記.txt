■qhapaqさんの「アピール文から読み解くWCSC27の見どころ（Apery編、書きかけ）」を読んで

いつも楽しく拝読しています。

・雑巾絞りの性質とソフトの棋風の関連性について私が１つ補足するとするならば、まふ定跡ver10で入れています
▲7六歩△3四歩▲2六歩△8四歩▲2五歩△8五歩▲7八金△3二金▲2四歩△同歩▲同飛△8六歩▲同歩△同飛▲5八玉△5二玉▲2六飛△8二飛▲8七歩打△2三歩打▲3八銀△7二銀
この局面から
MultiPV＝１の３０００万ノード
MultiPV＝３の３０００万ノード
を対局させた場合、MultiPV＝１のほうは▲５二玉のまま戦おうとしますが、
MultiPV＝３のほうは高確率で升田式ひねり飛車（坊主美濃）のように▲２八玉まで移動しようとします。

通常、升田式ひねり飛車は相手が駒組みをしているなら▲４八玉、▲３八玉、▲２八玉と移動していく構想ですが、まふ定跡の場合△7二銀の時点で最初の駒組みは終わっているとも言えます。
ここから▲４八玉、▲３九玉なんて移動していくなら６九の地点にデッカイ穴が出来てしまいます。
後手の飛車先が切れているので、角交換から△６九角打で強引に飛車をねじ込まれます。

つまり、MultiPV＝３の３０００万ノードでは広く浅く読んでしまった結果、その手筋の評価が正しく成されていないものだと思われます。
この角交換から△６九角打で強引に飛車をねじ込む指し手を見て将棋ソフトは豪腕だと思う人は、その前段階の局面が正しく認識出来ていないものだと思われます。

わかりやすく浅いノード数の例をあげましたが、深い探索でも読み抜けがあったり、Ponderヒットにより読み抜けすれば同じことが起こります。
具体例は読み太のver2以降です。
qhapaqさんもstockfishはビビり過ぎと書いていた気がしますが、チェスは駒が減っていくので将棋と違って１ミスでどうしようも無くなります。
将棋は一時的に駒が取られても、後から取り返せるのであれば駒を捨てることが出来るくらいには違います。

これを探索部がほぼstockfishの状態であるSILENT_MAJORITYと、枝刈りを調整した読み太ver2以降を同じ持ち時間＋評価関数、定跡ＯＦＦで比べるとこうなります。

序盤・・・SILENT_MAJORITY＞読み太
中盤・・・SILENT_MAJORITY＝読み太
終盤・・・SILENT_MAJORITY＜読み太

１ミスでどうしようも無くなるチェスのプログラムでは序盤＋中盤初期までが異常に強いです。（保守的な動きの大きな理由のひとつと思います）
また、読み太のほうは枝刈りが激しいので、定跡ＯＦＦだと序盤ＰＶハマりを起こしやすい。千日手を拾いやすい等の問題が重なります。

チェスは定跡が整備されていること。駒が減っていくことで探索深さが増えていくこと。終盤が整備されていること。
これらの構造上、中盤初期に合わせているプログラムであると予想されます。
将棋の場合は駒の総和が最初から最後まで変わらないので、探索はどんどん負荷がかかります。（詰みを見つけるまで）

ある一定のノード数を超えると激しい枝刈りでもＰＶを見直したり（反復深化深さ優先探索？）して同じ読み筋にたどり着きます。
また、同じ評価関数を使うと見えにくいですが、相手の指し手が予想手と違ってfollow up movesが利かずにＰＶの読み直しが起こると読み太のほうが良いです。
このことからどちらが将棋のプログラムとして合っているかと言えば、読み太のほうだと私は思います。
（序盤の問題を定跡整備でカバーするか、定跡から逃げて評価関数で勝負するかの問題はあると思いますが）

大将軍編の記事で評価関数のパラメタ数に疑問を持たれていましたが、圧倒的に少ない２駒の新技巧がどのくらいの強さなのか比較すれば、
そもそもＫＰＰＴ程必要なのかどうなのかわかるのではないでしょうか。



■まふ定跡がやねうら王形式に対応していない件について

別に私がやねうら王形式を否定している訳ではありません。
（むしろソフト開発者的にsfen形式のほうが良いのではないかと思っています）
単純にShogiGUI開発者様のBookConvを使用して変換している関係で出来ないのです。
（https://github.com/ai5/BookConv/releases）

ShogiGUIの定跡ファイル形式＝SBKファイルからやねうら王定跡(.db)に変換すると、採用率０の千日手が含まれる定跡でハングしていたと思います。
同様の不具合が技巧形式で存在し開発者様にご無理を言って直していただきました。

ひょっとしたらBookConvの入力が技巧に対応しているのでまふ定跡技巧版を入力し、やねうら王定跡に出力すればいけるかも？（未検証）
※ただし、ShogiGUIの定跡ファイルからやねうら王定跡(.db)に変換すると対局数が採用率となり、意図した動作にならなかったと思います。

どなたかやねうら王形式の出力に対応していただければ、変換添付したいと思っています。

また、BookConvの出力はShogiGUIの定跡（.sbk)にも出来るので、まふ定跡技巧版を入力すれば誰でも簡単に加工出来るのでは？（未検証）
※たしか技巧形式に変換するときは、採用率０％の指し手は削除されていた気がしますが。ソフト開発者的にはそっちのほうが良い？



■floodgateに出てきたMaidy_Maidyが強すぎる

３局しか見て無いけど、Ukamuse_KabyLake-7700Kとハードの性能が同じくらいなら、浮かむ瀬よりＲ＋１００〜２００くらい有りそう。
真やね定跡っぽいからtanuki？
第27回世界コンピュータ将棋選手権の楽しみが増えました。
出来れば選手権終了後に私の低スペＰＣで動くようなsse4.2verでも出してほしいところです。



■コンピュータ将棋スレッド116＞瞬間角道止まるこの桂跳ねやるソフトはたぬき以外あるのかな？

相掛かり戦で鎖鎌銀のように銀が突進してくる場合に、中段飛車とセットで良く見る手筋です。
棋譜を見た限りノーマルの相掛かりを良く学習していると思われます。
このような細かい動きは定跡制御が難しいことと、いままでの将棋ソフトの学習量ではponanza以外は不足していると思われます。

補足
鎖鎌銀が得意な郷田真隆九段が相手にUFO銀（相掛かり棒銀のひとつ）をやられたときに、この型で受けていたと思います。
UFO銀＝▲３六銀に△３三桂＋中段飛車で角道を開けた△３四歩で△３五歩とぶつけていく。
△３三桂が２五＋４五の地点に利いており、△３五歩は中段飛車にヒモ付いているので銀は撤退せざるをえません。
人間同士なら早々に銀を繰り出し心理的プレッシャーを与える効果等がありますがこれをやられると２手損です。
あとは３筋を伸ばした歩に△３三桂は石田流です。飛車先の１歩を持っているので破壊力はさらに上です。
坊主美濃なので升田式ひねり飛車のほうが近いかな。



■floodgateに出てきたajkの定跡は見習う点が多い

http://wdoor.c.u-tokyo.ac.jp/shogi/LATEST/2017/04/23/wdoor+floodgate-300-10F+SM_NB10_2c+ajk+20170423213007.csa
で２５手目の▲４五桂はもともと疑問手として採用しているが、以下４１手目▲６六銀まで進んで４２手目は普通はぱっと見△２八角打だろう。
１九の香車を取り込んで馬を作っている間に、飛車にヒモ付けた▲４四銀打から▲６六銀を５五銀と持ってきて
飛車＋銀＋銀＋桂馬でいっきに王様を攻める構想なのだが、ajkの定跡は４２手目は△８三銀！
これで４段目から飛車がどかされて、落ち着いて△２八角打から完勝。上記の攻めを読みきった定跡を入れられていた。
たしか４１手目で▲４四銀打から勝っていた対局があったと思うが、個人的に攻めが続かず疑問手判断を過去にしたと思うので、
ver11では２５手目の▲４五桂は不採用ですね。



■コンピュータ将棋スレッド117＞まふ定跡この△２八歩も入れておいたほうがいいかも。ここで△７八桂成として後手が負けた棋譜を見かけたもんで 

コメントありがとうございます。
１６手目の応手は△５二玉が１００％であるため、使ってくださっている方に悪いのでver11では△２八歩打からの勝ち棋譜を追加しました。

Readme（開発者向け 5）に書いた、このルートの一部解説

まずは受け側の第１トラップ必敗型
http://wdoor.c.u-tokyo.ac.jp/shogi/view/2017/04/23/wdoor+floodgate-300-10F+ajk+sm124m10+20170423203008.csa/27

この棋譜のように28手目△7八成桂が大悪手です。
※ここで興味深いのは後手のソフトが＋２２５で攻め側が良しと評価している所です
何が悪手かと言うと、そもそも26手目△8六桂打の意味は厳しい寄せの一手で相手の攻め駒を使わせて、受け側が詰まされないようにした一手です。
ですからこの桂馬で金を取ってしまうと相手に桂馬（攻め駒）を渡してしまい何をしているのかわかりません。
以下30手目△9九竜まで進んで相手の猛攻が始まります。
どんどん寄せられていって、どんな上手い受けをしても最後は▲8四歩打で逃げ道を塞がれ死にます。（ルートによっては▲7五桂打）
つまり、間接的に△9九竜も悪手で８筋の利きが無くなっているのです。
飛車がもう１枚手に入っていますので８筋に利かして▲8四歩を取ることも出来ますが、これは延命しただけで結果は変わりません。

ここで覚えておくことは28手目△7八成桂が大悪手で、間接的に△9九竜も悪手となるのでここぞという瞬間でしか△7八成桂は出来ないことです。


次は攻め側の第１トラップ必敗型
http://wdoor.c.u-tokyo.ac.jp/shogi/view/2017/04/24/wdoor+floodgate-300-10F+Maidy_Maidy+SM_NB10_2c+20170424050002.csa/28
http://wdoor.c.u-tokyo.ac.jp/shogi/view/2017/04/24/wdoor+floodgate-300-10F+Maidy_Maidy+SM_NB10_2c+20170424233009.csa/28

上記で受け側は28手目△7八成桂と出来ません。28手目の絶対手は△2八歩打です。
※ここで興味深いのは先手のソフトが＋３２６で攻め側が良しと評価している所です
（Maidy_Maidyは定跡にこの評価値が付いているようなので、	17手目▲2二馬の評価値＋１０４をマイナスに修正すれば良いだけ？）
何が悪手かと言うと、△2八歩打を放置したことです。詳細は本譜を確認して下さい。
結論から言えば△2八歩打は銀で取って難解な局面になります。
△2八歩打の意味は放置して攻め合いになれば勝ちですし、取られて▲2八銀の形になるのなら将来的に9九の香車を取って５筋に打ち込み、
５七の地点を駒損でも強引に食い破る手筋で金を釣り上げ、銀の横腹の３八飛車打（王手銀取り）で寄せていく筋とかを狙った手です。
ネタバレすると▲2八銀を狙った筋は限りなく必勝に近いですが、攻め側にすごい上手い受けがあるので失敗します。


最長ルートでトラップは５つ有るので、正直言って強豪ソフトが攻め側＋受け側の第１トラップで死ぬとは思っていませんでした。
特にMaidy_Maidyが＋３２６から数手進んで−７００とかで、その差約１０００もの誤評価を出していることにも驚きました。
Readme（開発者向け 5）に書いたように、いまの将棋ソフトの序盤の問題が良く見てとれる棋譜だったのではないかと思います。
もちろんこれは極端な例ですが、序盤の問題は細かいレベルでたくさん存在しているので、この部分を改良出来るソフトが出るとさらにレートが伸びると思います。



■真やねうら定跡には第２形態があると思う

真やねうら定跡の中身を初めて見たときに、定跡的には絶対やってはいけない指し手が探索深さ３０で入っていて驚いた覚えがあります。
（どちらが正しいのか念のために検証し、既存の定跡が正しいことを確認しました）
MultiPVで広げた所が良かった点で、まだ玉石混合しています。
おそらく短時間対局でもいいので自己対局で大量の棋譜を生成し、qhapaqさんのツールで勝率の悪い指し手を削除すればＲ＋５０は上がると思っています。

qhapaqさんのツールは「定跡の雑巾絞り」が出来るのではないかと見ていますが、選手権の河童全力定跡を楽しみにしています。



■floodgateに出てきたmonkeymagicが強い

あきらかに以前現れたときより強い。（ハードの差だけだとは思えないほどに）
評価値グラフがきれいに出ていて、並の雑巾絞り職人ではない。
どう見てもApery開発者だと思うけれども、これ違う人だったら新たな評価関数職人の誕生ですがはたして誰なんでしょう。

定跡作成している立場で言えばmonkeymagicが指した手の中に、これそのまま定跡になると思う指し手があった。

ただ、定跡進行の評価値出しすぎは問題ありそう？
floodgateの棋譜から学習している人もいると思うので、いい加減に作成した定跡にこの評価値が付いていると変な指し手を学習することにならないだろうか？
※monkeymagicは強いから問題はあまり無いのかもしれないが、以前floodgateに自作定跡でこの評価値を出していたソフトがいたと思う。



■SILENT_MAJORITY１．２５（最新ver）https://github.com/Jangja/silent_majority/tree/1.2/bin

ちょっと使ってみましたが、１．２４に比べるとあきらかにＰＶの見方が変わっている。
例えば下記の局面。（超急戦から先手が上手く逃げ切った局面＝▲４四馬で先手勝勢）
MultiPV１，２，３あたりで１．２４と１．２５を見比べると、だいたいのニュアンスを掴めると思います。
個人的には感触の良い指し手を１．２４より早くに見つけてくる印象。
（と言ってもこの局面、技巧や読み太だと１億ノードも読めば先手＋４０００とか叩き出しますけど）
探索部をstockfishに依存している人は、間に合うのならキャッチアップしたほうが良いと思う。

後手の持駒：金 歩二 
  ９ ８ ７ ６ ５ ４ ３ ２ １
+---------------------------+
|v香v桂 ・v金 ・v金 ・v桂 馬|一
| ・ ・v銀 ・v玉 ・ ・ ・ ・|二
|v歩 ・v歩v歩v歩v歩 ・ ・v歩|三
| ・ ・ ・ ・ ・v銀v歩 飛 ・|四
| 歩 ・ ・ ・ ・ ・ ・ ・ ・|五
| ・ ・ 歩 ・ 香 玉 歩 ・ ・|六
| ・ ・ ・ 歩 歩 歩 ・ ・ 歩|七
| ・ ・ ・ ・ ・v龍 銀 ・ ・|八
| 香 ・ ・ ・ ・ ・v銀 桂 香|九
+---------------------------+
先手の持駒：角 金 桂 歩二 



■将棋ソフト同士の対局で振り飛車の勝率が低い原因を考えてみた

最近特に思うのが将棋ソフトと振り飛車＋美濃囲いの相性が悪いのではないか？
この記事が囲いの構想について良くまとまっており、
http://gruber-matin.hatenablog.com/entry/2017/01/20/002045
「美濃囲いは金銀が互いにスクラムを組んでおり、もともと王手がかかるまで手数のかかる囲い」であり、
人間は危険の芽を早めに摘みに行こうとしますが、将棋ソフトはギリギリまで読みきろうとします。
しかも囲いに手がつけられるような状況はおよそ終盤付近であり、探索部がstockfish系全盛期のソフト群では気がついたら悪くなっていたという確率が高い？
例えば相振り飛車のとき将棋ソフトは美濃囲いや振り飛車穴熊を崩すのは得意でも、金無双をなかなか崩せません。
将棋ソフトに有効な囲い（人間の感性では違和感があったとしても）が発見されると振り飛車がめちゃくちゃ強くなるかもしれません。
（最終的にはぐるっと廻ってギリギリまで居玉が結論で、それ藤井システムじゃないかとなったり）